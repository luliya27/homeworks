<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>行事曆</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <style>
        table {
            border: 1px solid #cccccc;
            text-align: center;
        }

        table tr {
            /* padding: 20px; */
        }

        table th,
        td {
            border: 1px solid #cccccc;
            padding: 15px 25px;
            height: 70px;
            max-height: 100px !important;
        }

        #Calendar {
            /* display: flex;
            justify-content: center; */
            margin-left: auto;
            margin-right: auto;
        }

        #ctrl-future button {
            margin: 0px 20px;
        }

        #ctrl-past button {
            margin: 0px 20px;
        }

        #btn-ctrl {
            /* display: flex;
            justify-content: center; */
            margin-left: auto;
            margin-right: auto;
        }

        #btn-ctrl button {
            padding: 5px 15px;
        }

        .mark-today {
            background-color: aliceblue;
        }

        input::-webkit-input-placeholder {
            /* WebKit browsers */
            color: #ccc;
        }

        input:-moz-placeholder {
            /* Mozilla Firefox 4 to 18 */
            color: #ccc;
        }

        input::-moz-placeholder {
            /* Mozilla Firefox 19+ */
            color: #ccc;
        }

        input::-ms-input-placeholder {
            /* Internet Explorer 10+ */
            color: #ccc;
        }
    </style>
    <!-- <script src="/JS專案/行事曆/Calendar2.js"></script> -->
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 d-flex justify-content-center mt-3">
                <div id="ctrl-past"></div>
                <div id="showdate"></div>
                <div id="ctrl-future"></div>
                <div id="new-text"></div>
                <!-- <button class="" id=""></button> -->
            </div>
        </div>
        <div class="row">
            <div class="col-12 d-flex justify-content-center mt-3">
                <div id="Calendar"></div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-12 d-flex justify-content-center">
                <div id="test"></div>
                <div id="new-text"></div>
                <div id="text"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="textModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">新增事項</h5>
                    <button class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="input-group flex-nowrap mb-3">
                        <input type="date" class="form-control" placeholder="輸入時間" aria-label="Username"
                            aria-describedby="inputGroup-sizing-default">
                    </div>
                    <div class="input-group flex-nowrap mb-3">
                        <input type="time" class="form-control" placeholder="輸入時間" aria-label="Username"
                            aria-describedby="inputGroup-sizing-default">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">標題</span>
                        </div>
                        <input type="text" class="form-control" aria-label="Sizing example input"
                            aria-describedby="inputGroup-sizing-default">
                        <div class="input-group-prepend">
                            <input type="color" class="form-control input-group-text">
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <textarea class="form-control" id="textarea" rows="5"></textarea>
                    </div>
                    <div class="input-group flex-nowrap mb-3">
                        <input data-jscolor="{position:'right'}" value="2CAFFE" class="form-control">
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="">修改</button>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button class="btn btn-info" onclick="SaveData()" id="save">儲存新增</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous">
    </script>
    <script src="/bower_components/jscolor/jscolor.js"></script>
    <script>
        let dateNow = new Date();
        let currentYear = dateNow.getFullYear();
        let currentMonth = dateNow.getMonth() + 1; //getMonth()返回數字 0(一月)~11(十二月)

        var goale_month = new Date(); //全域變數 控制月份
        // var now_m = new Date().getMonth(); //取得現在所屬月份 (會少1數)
        table(goale_month); //goale_month參考
        btn();

        function table(now_m) { //now_m 全域宣告
            var year = now_m.getFullYear(); //年
            var month = now_m.getMonth(); //月
            var today = now_m.getDate(); //天
            var mark = document.getElementsByTagName('td');
            //today.classList.add('mark-today');

            // // 得到 我的當日
            // var firstDay = new Date(year, month, 1); //6
            // // 得到 我的當月
            // var monthDay = new Date(year, month + 1, 0).getDate(); //31
            // // 得到 我的當天
            // var day = new Date(); //日期變數

            var display = document.getElementById('showdate')
            display.innerHTML = `<h2>${year}年${month+1}月</h2>`

            var body = document.getElementById('Calendar')

            let table = document.createElement('table');
            let thead = document.createElement('thead');
            let tbody = document.createElement('tbody');

            for (let k = 1; k < 2; k++) {
                let theadtr = document.createElement('tr'); //thead tr
                // 一周七天 7個空格 th
                for (let i = 1; i < 8; i++) {
                    // 建立th
                    let theadtrth = document.createElement('th'); //thead th
                    // 建立 i個th
                    theadtrth.innerText = i;
                    // 建立 th 於theadtr tr裡
                    theadtr.appendChild(theadtrth)
                }
                thead.appendChild(theadtr)
            }

            // ------------------------
            // var now_m = new Date().getMonth(); //取得現在所屬月份 (會少1數)
            var getMonth = month + 1; // 取得當月 (+1 補回來)

            var Numday = new Date(year, getMonth - 1, 1).getDay() == 0 ? 7 : new Date(year, getMonth - 1, 1)
                .getDay(); //判斷日期為1 要是星期天
            // 原本寫法
            // var Numday2;
            // if(new Date(year, getMonth - 1, 1).getDay()){
            //     Numday2 = new Date(year, getMonth - 1, 1).getDay();
            // }
            // else{
            //     Numday2 = 7;
            // }
            var MaxNumday = new Date(year, getMonth, 0).getDate() //判斷當月有幾天
            var number = 1 - (Numday - 1); //初始值 判斷 星期幾減1

            // let rows = Math.ceil((monthDay - day + 1) / 7) //後續天數處理
            // 判斷有幾列tr
            for (let j = 0; j < 6; j++) {
                let tbodytr = document.createElement('tr'); //tbody tr
                // 一周七天 7個空格 td
                for (let i = 0; i < 7; i++) {
                    var textid = document.querySelectorAll('td')
                    //console.log(textid)
                    textid.forEach(x => {
                        tbodytrtd.setAttribute("id",
                            `${year.toString().padStart(2,"0")}-${month.toString().padStart(2,"0")}`)
                    });
                    //console.log(textid)
                    // 建立 td
                    let tbodytrtd = document.createElement('td'); //thead td
                    // 判斷數字
                    if (number <= 0) {
                        tbodytrtd.innerText = ''; //字串清空
                    } else if (MaxNumday < number) {
                        // tbodytrtd.innerText = ''
                        console.log(MaxNumday)

                    } else {
                        tbodytrtd.innerText = number
                    }

                    number++
                    // 建立 td 於tbodytr tr裡
                    tbodytr.appendChild(tbodytrtd);
                }
                tbody.appendChild(tbodytr)
            }

            table.appendChild(thead) //添加thead
            table.appendChild(tbody) //添加tbody
            body.appendChild(table) //添加table

            // -----------------------------------
            // 改變thead th 標題
            let week = ["Mon", "Tue", "Wen", "Thu", "Fri", "Sat", "Sun"];
            // 放到對應 th
            let weekName = document.querySelectorAll('th')
            for (let i = 0; i <= 6; i++) {
                // 打印出星期字樣
                weekName[i].innerText = week[i];
            }
            // showTodoData(currentYear, currentMonth);
        }

        function btn() {
            // var btn = document.getElementById('btn-ctrl')
            // btn.innerHTML =
            //     `<button class="btn btn-info" onclick="btn_past()">＜</button> <button class="btn btn-info" onclick="btn_future()">＞</button>`
            var btn_past = document.getElementById('ctrl-past')
            btn_past.innerHTML = `<button class="btn btn-info" id="past" onclick="btn_past()">＜</button>`
            var btn_future = document.getElementById('ctrl-future')
            btn_future.innerHTML = `<button class="btn btn-info" id="future" onclick="btn_future()">＞</button>`
        }

        function btn_past() {
            var display = document.getElementById('showdate')
            var calender = document.getElementById('Calendar')
            //清空月曆生成
            calender.innerHTML = ''
            display.innerHTML = ''

            goale_month.setMonth(goale_month.getMonth() - 1);
            table(goale_month);
        }


        function btn_future() {
            var display = document.getElementById('showdate')
            var calender = document.getElementById('Calendar')
            //清空月曆生成
            calender.innerHTML = ''
            display.innerHTML = ''
            console.log(goale_month + 1);

            goale_month.setMonth(goale_month.getMonth() + 1);
            table(goale_month);
        }

        newtext()

        function newtext() {
            var new_text = document.getElementById('new-text')
            new_text.innerHTML =
                '<button class="btn btn-primary" data-toggle="modal" data-target="#textModal">新增記事</button>'
        }
        // -----------
        modal()

        function modal() {
            var text = document.getElementById('text');
            text.innerHTML =
                `
            <div class="modal fade" id="textModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">新增事項</h5>
                        <button class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="input-group flex-nowrap mb-3">
                        <input type="date" class="form-control" placeholder="輸入時間" aria-label="Username"
                            aria-describedby="inputGroup-sizing-default">
                        </div>
                        <div class="input-group flex-nowrap mb-3">
                        <input type="time" class="form-control" placeholder="輸入時間" aria-label="Username"
                            aria-describedby="inputGroup-sizing-default">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">標題</span>
                        </div>
                        <input type="text" class="form-control" aria-label="Sizing example input"
                            aria-describedby="inputGroup-sizing-default">
                        </div>
                        <div class="input-group mb-3">
                        <textarea class="form-control" id="textarea" rows="5"></textarea>
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">標籤</span>
                            </div>
                            <input data-jscolor="{position:'right'}" value="#DCFBFF" class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                    <button class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button class="btn btn-info" onclick="SaveData()" id="save">儲存新增</button>
                    </div>
                </div>
            </div>
        </div>
            `
        }

        function clicksave() {

        }

        function SaveData(day, time, title, text, color) {
            //哪一天處理代辦事項
            var dayinpute = document.getElementsByTagName('input')[0].value

            // 哪一時間處理代辦事項
            var timeinpute = document.getElementsByTagName('input')[1].value

            // 代辦事項 標題
            var titleinput = document.getElementsByTagName('input')[2].value

            // 代辦事項 內容
            var textinput = document.getElementsByTagName('textarea')[0].value

            // 代辦事項 標簽顏色
            var colorinput = document.getElementsByTagName('input')[3].value


            // key值
            let temp = {
                day: dayinpute,
                time: timeinpute,
                title: titleinput,
                text: textinput,
                color: colorinput
            }
            localStorage.setItem(Date.now(), JSON.stringify(temp));

            //顯示記事內容
            let showtemp = JSON.parse(localStorage.getItem('title'));
            document.getElementById('test').innerText = temp.title;

            let catchtemp = JSON.parse(localStorage.getItem('day'));
            document.querySelectorAll('table + td').innerText = temp.day
        }

        // 顯示記事標籤
        // function showTodoData(currentYear, currentMonth) {

        //     for (var i = 0; i < localStorage.length; i++) {
        //         let data = JSON.parse(localStorage.getItem(localStorage.key(i)));
        //         let dataDate = data.date;

        //         if ((currentYear + "-" + currentMonth.toString().padStart(2, "0")) == dataDate.substring(0, 7)) { //判斷是否為該月事項
        //             let datakey = localStorage.key(i);
        //             let title = (data.title).toString();
        //             let targetTD = document.getElementById(dataDate); //querySelector不支援搜尋數字開頭的ID所以要改用getElementById
        //             let button = document.createElement("button");
        //             button.classList.add("btn", "btn-block", "text-left", "border", "border-secondary", "rounded")
        //             button.style.backgroundColor = data.color;
        //             button.textContent = title.length <= 5 ? title : title.substring(0, 5) + "...";
        //             button.dataset.toggle = "modal";
        //             button.dataset.target = "#textModal"

        //             button.addEventListener("click", function () {
        //                 //Model切換
        //                 addBtn.classList.add("d-none");
        //                 deleteBtn.classList.remove("d-none");
        //                 modifyBtn.classList.remove("d-none");
        //                 document.querySelector(".modal-title").textContent = "修改行程";
        //                 document.querySelector("#modifyTime").textContent = `更新時間：${data.updateTime}`;

        //                 //把Data的key設定在按鈕上
        //                 deleteBtn.setAttribute("value", datakey);
        //                 modifyBtn.setAttribute("value", datakey);

        //                 document.querySelector("#title").value = data.title;
        //                 document.querySelector("#date").value = dataDate;
        //                 document.querySelector("#time").value = data.time;
        //                 document.querySelector("#contents").value = data.contents;
        //                 document.querySelector("#color").value = data.color;
        //                 document.querySelector("#position").value = data.position;
        //             })
        //             targetTD.append(button);
        //         }
        //     }
        // }


        function LoadData() {
            let temp = JSON.parse(localStorage.getItem('Name'));
            // 改變顏色
            document.getElementById('text').innerText = temp.CName;
            document.getElementById('text').innerText = temp.Color;
        }
    </script>

</body>

</html>